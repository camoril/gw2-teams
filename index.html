<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WvW Roster - Guild Wars 2</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            color: #e0e0e0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .gw2-brand {
            color: #00d4ff;
            font-weight: bold;
        }
        .form-card {
            background: rgba(45, 45, 45, 0.9);
            border: 1px solid #444;
            border-radius: 8px;
            padding: 24px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        .input-field {
            background: rgba(20, 20, 20, 0.7);
            border: 1px solid #555;
            color: #e0e0e0;
            padding: 10px 12px;
            border-radius: 6px;
            transition: border-color 0.3s;
        }
        .input-field:focus {
            outline: none;
            border-color: #00d4ff;
            box-shadow: 0 0 8px rgba(0, 212, 255, 0.3);
        }
        .btn-primary {
            background: linear-gradient(135deg, #00d4ff 0%, #0099cc 100%);
            color: #000;
            font-weight: bold;
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(0, 212, 255, 0.4);
        }
        .btn-secondary {
            background: rgba(100, 100, 100, 0.8);
            color: #e0e0e0;
            padding: 10px 16px;
            border: 1px solid #666;
            border-radius: 6px;
            cursor: pointer;
            transition: background 0.2s;
        }
        .btn-secondary:hover {
            background: rgba(120, 120, 120, 0.9);
        }
        .character-entry {
            background: rgba(35, 35, 35, 0.8);
            border-left: 4px solid #00d4ff;
            padding: 16px;
            margin-bottom: 12px;
            border-radius: 4px;
        }
        .character-entry:hover {
            background: rgba(40, 40, 40, 0.9);
        }
        .roster-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        .roster-table th {
            background: rgba(0, 212, 255, 0.1);
            border-bottom: 2px solid #00d4ff;
            padding: 12px;
            text-align: left;
            color: #00d4ff;
        }
        .roster-table td {
            border-bottom: 1px solid #444;
            padding: 12px;
        }
        .roster-table tr:hover {
            background: rgba(0, 212, 255, 0.05);
        }
        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            background: rgba(0, 212, 255, 0.2);
            color: #00d4ff;
        }
    </style>
</head>
<body>
    <div class="min-h-screen py-8 px-4">
        <div class="max-w-6xl mx-auto">
            <!-- Header -->
            <div class="text-center mb-12">
                <h1 class="text-5xl font-bold mb-2">
                    <span class="gw2-brand">WvW</span> Roster
                </h1>
                <p class="text-gray-400 text-lg">Guild Wars 2 World vs World Player Registration</p>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <!-- Form Section -->
                <div class="lg:col-span-2">
                    <div class="form-card">
                        <h2 class="text-2xl font-bold mb-6 gw2-brand">Add Character</h2>
                        
                        <form id="characterForm">
                            <!-- Player Name -->
                            <div class="mb-6">
                                <label class="block text-sm font-semibold mb-2">Player Name *</label>
                                <input 
                                    type="text" 
                                    id="playerName" 
                                    class="input-field w-full"
                                    placeholder="Your account name"
                                    required
                                >
                            </div>

                            <!-- Character Name -->
                            <div class="mb-6">
                                <label class="block text-sm font-semibold mb-2">Character Name *</label>
                                <input 
                                    type="text" 
                                    id="characterName" 
                                    class="input-field w-full"
                                    placeholder="Your character name"
                                    required
                                >
                            </div>

                            <!-- Role -->
                            <div class="mb-6">
                                <label class="block text-sm font-semibold mb-2">Role *</label>
                                <select id="role" class="input-field w-full" required>
                                    <option value="">Select a role</option>
                                    <option value="ranged-healer">Ranged Healer</option>
                                    <option value="melee-healer">Melee Healer</option>
                                    <option value="cleanse-support">Cleanse Support</option>
                                    <option value="boon-support">Boon Support (Stab/Aegis/Quickness/Alacrity)</option>
                                    <option value="frontline-dps">Frontline DPS</option>
                                    <option value="ranged-dps">Ranged DPS</option>
                                    <option value="backline-dps">Backline DPS</option>
                                    <option value="utility">Utility</option>
                                    <option value="flexible">Flexible</option>
                                </select>
                            </div>

                            <!-- Class/Spec -->
                            <div class="mb-6">
                                <label class="block text-sm font-semibold mb-2">Class / Specialization *</label>
                                <select id="classSpec" class="input-field w-full" required>
                                    <option value="">Select a class</option>
                                    <!-- WARRIOR -->
                                    <optgroup label="Warrior">
                                        <option value="warrior">Warrior (Base)</option>
                                        <option value="warrior-berserker">Warrior - Berserker</option>
                                        <option value="warrior-spellbreaker">Warrior - Spellbreaker</option>
                                        <option value="warrior-bladesworn">Warrior - Bladesworn</option>
                                        <option value="warrior-paragon">Warrior - Paragon</option>
                                    </optgroup>
                                    <!-- GUARDIAN -->
                                    <optgroup label="Guardian">
                                        <option value="guardian">Guardian (Base)</option>
                                        <option value="guardian-dragonhunter">Guardian - Dragonhunter</option>
                                        <option value="guardian-firebrand">Guardian - Firebrand</option>
                                        <option value="guardian-willbender">Guardian - Willbender</option>
                                        <option value="guardian-luminary">Guardian - Luminary</option>
                                    </optgroup>
                                    <!-- REVENANT -->
                                    <optgroup label="Revenant">
                                        <option value="revenant">Revenant (Base)</option>
                                        <option value="revenant-herald">Revenant - Herald</option>
                                        <option value="revenant-renegade">Revenant - Renegade</option>
                                        <option value="revenant-vindicator">Revenant - Vindicator</option>
                                        <option value="revenant-conduit">Revenant - Conduit</option>
                                    </optgroup>
                                    <!-- RANGER -->
                                    <optgroup label="Ranger">
                                        <option value="ranger">Ranger (Base)</option>
                                        <option value="ranger-druid">Ranger - Druid</option>
                                        <option value="ranger-soulbeast">Ranger - Soulbeast</option>
                                        <option value="ranger-untamed">Ranger - Untamed</option>
                                        <option value="ranger-galeshot">Ranger - Galeshot</option>
                                    </optgroup>
                                    <!-- ENGINEER -->
                                    <optgroup label="Engineer">
                                        <option value="engineer">Engineer (Base)</option>
                                        <option value="engineer-scrapper">Engineer - Scrapper</option>
                                        <option value="engineer-holosmith">Engineer - Holosmith</option>
                                        <option value="engineer-mechanist">Engineer - Mechanist</option>
                                        <option value="engineer-amalgam">Engineer - Amalgam</option>
                                    </optgroup>
                                    <!-- THIEF -->
                                    <optgroup label="Thief">
                                        <option value="thief">Thief (Base)</option>
                                        <option value="thief-daredevil">Thief - Daredevil</option>
                                        <option value="thief-deadeye">Thief - Deadeye</option>
                                        <option value="thief-specter">Thief - Specter</option>
                                        <option value="thief-antiquary">Thief - Antiquary</option>
                                    </optgroup>
                                    <!-- ELEMENTALIST -->
                                    <optgroup label="Elementalist">
                                        <option value="elementalist">Elementalist (Base)</option>
                                        <option value="elementalist-tempest">Elementalist - Tempest</option>
                                        <option value="elementalist-weaver">Elementalist - Weaver</option>
                                        <option value="elementalist-catalyst">Elementalist - Catalyst</option>
                                        <option value="elementalist-evoker">Elementalist - Evoker</option>
                                    </optgroup>
                                    <!-- MESMER -->
                                    <optgroup label="Mesmer">
                                        <option value="mesmer">Mesmer (Base)</option>
                                        <option value="mesmer-chronomancer">Mesmer - Chronomancer</option>
                                        <option value="mesmer-mirage">Mesmer - Mirage</option>
                                        <option value="mesmer-virtuoso">Mesmer - Virtuoso</option>
                                        <option value="mesmer-troubadour">Mesmer - Troubadour</option>
                                    </optgroup>
                                    <!-- NECROMANCER -->
                                    <optgroup label="Necromancer">
                                        <option value="necromancer">Necromancer (Base)</option>
                                        <option value="necromancer-reaper">Necromancer - Reaper</option>
                                        <option value="necromancer-scourge">Necromancer - Scourge</option>
                                        <option value="necromancer-harbinger">Necromancer - Harbinger</option>
                                        <option value="necromancer-ritualist">Necromancer - Ritualist</option>
                                    </optgroup>
                                </select>
                            </div>

                            <!-- Gear -->
                            <div class="mb-6">
                                <label class="block text-sm font-semibold mb-2">Gear / Build Quality *</label>
                                <select id="gear" class="input-field w-full" required>
                                    <option value="">Select gear quality</option>
                                    <option value="legendary">Legendary</option>
                                    <option value="ascended">Ascended</option>
                                    <option value="exotic">Exotic</option>
                                    <option value="rare">Rare</option>
                                    <option value="mixed">Mixed / Leveling</option>
                                </select>
                            </div>

                            <!-- Notes -->
                            <div class="mb-6">
                                <label class="block text-sm font-semibold mb-2">Notes (Optional)</label>
                                <textarea 
                                    id="notes" 
                                    class="input-field w-full"
                                    placeholder="Any additional info about your character (weapon preferences, experience level, etc.)"
                                    rows="4"
                                ></textarea>
                            </div>

                            <!-- Buttons -->
                            <div class="flex gap-4">
                                <button type="submit" class="btn-primary">Add Character</button>
                                <button type="reset" class="btn-secondary">Clear Form</button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Stats Section -->
                <div>
                    <div class="form-card">
                        <h2 class="text-xl font-bold mb-4 gw2-brand">Team Statistics</h2>
                        <div class="space-y-4">
                            <div>
                                <p class="text-gray-400 text-sm">Total Players</p>
                                <p class="text-3xl font-bold gw2-brand" id="totalPlayers">0</p>
                            </div>
                            <div>
                                <p class="text-gray-400 text-sm">Total Characters</p>
                                <p class="text-3xl font-bold gw2-brand" id="totalCharacters">0</p>
                            </div>
                            <div>
                                <p class="text-gray-400 text-sm">Most Common Role</p>
                                <p class="text-xl font-bold gw2-brand" id="commonRole">-</p>
                            </div>
                            <div>
                                <p class="text-gray-400 text-sm">Most Used Class</p>
                                <p class="text-xl font-bold gw2-brand" id="commonClass">-</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Boons Information Panel -->
            <div class="mt-12">
                <div class="form-card">
                    <h2 class="text-2xl font-bold mb-6 gw2-brand">Team Boons Analysis</h2>
                    <p class="text-gray-400 text-sm mb-6">Boons provided by characters in your roster</p>
                    
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <!-- Roster Boons -->
                        <div>
                            <h3 class="text-lg font-bold text-gray-300 mb-4">üìä All Team Boons</h3>
                            <div id="teamBoonDisplay" class="grid grid-cols-2 sm:grid-cols-3 gap-2"></div>
                            <div id="emptyRosterMessage" class="text-center py-6 text-gray-500">
                                No characters in roster yet. Add characters to see team boons.
                            </div>
                        </div>
                        
                        <!-- Boon Uptime Summary -->
                        <div>
                            <h3 class="text-lg font-bold text-gray-300 mb-4">‚ö° Boon Coverage</h3>
                            <div id="boonCoverageDisplay" class="space-y-2"></div>
                        </div>
                    </div>
                    
                    <!-- Individual Class Viewer -->
                    <div class="mt-8 pt-6 border-t border-gray-700">
                        <h3 class="text-lg font-bold text-gray-300 mb-4">üîç Inspect Boons by Class</h3>
                        <div class="mb-4">
                            <select id="boonClassSelect" class="input-field w-full">
                                <option value="">-- Select Class/Spec to inspect --</option>
                            </select>
                        </div>
                        <div id="boonDisplayArea" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-3"></div>
                    </div>
                </div>
            </div>

            <!-- Roster Table -->
            <div class="mt-12">
                <div class="form-card">
                    <h2 class="text-2xl font-bold mb-6 gw2-brand">Team Roster</h2>
                    
                    <div class="overflow-x-auto">
                        <table class="roster-table" id="rosterTable">
                            <thead>
                                <tr>
                                    <th>Player</th>
                                    <th>Character</th>
                                    <th>Role</th>
                                    <th>Class / Spec</th>
                                    <th>Gear</th>
                                    <th>Notes</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="rosterBody">
                                <tr>
                                    <td colspan="7" class="text-center py-8 text-gray-500">
                                        No characters registered yet. Add your first character above!
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Export Section -->
            <div class="mt-8 text-center space-y-4">
                <div>
                    <button id="exportBtn" class="btn-primary">Export Roster (JSON)</button>
                    <button id="importBtn" class="btn-secondary ml-4">Import to Roster</button>
                    <input type="file" id="importFile" accept=".json" style="display:none;">
                </div>
                <div>
                    <button id="importSquadBtn" class="btn-secondary">Import as Squad</button>
                    <input type="file" id="importSquadFile" accept=".json" style="display:none;">
                    <button id="manageSquadsBtn" class="btn-secondary ml-4">Manage Squads</button>
                </div>
            </div>

            <!-- Squads Management Modal -->
            <div id="squadsModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 1000; overflow-y: auto;">
                <div style="max-width: 900px; margin: 40px auto; background: #2d2d2d; border-radius: 12px; padding: 24px; box-shadow: 0 8px 32px rgba(0,0,0,0.5);">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h2 class="text-2xl font-bold gw2-brand">Manage Squads</h2>
                        <button id="closeSquadsModal" style="background: #666; color: white; padding: 8px 16px; border-radius: 6px; border: none; cursor: pointer;">Close</button>
                    </div>
                    <div id="squadsListContainer"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Boons Database - What boons can each class/spec provide
        const boonsByClass = {
            "guardian": ["Aegis", "Protection", "Regeneration", "Resistance"],
            "guardian-dragonhunter": ["Aegis", "Protection", "Regeneration", "Resistance", "Vigor"],
            "guardian-firebrand": ["Might", "Vigor", "Regeneration", "Stability", "Protection", "Resolution"],
            "guardian-willbender": ["Might", "Vigor", "Regeneration", "Stability", "Protection", "Quickness"],
            "guardian-luminary": ["Might", "Vigor", "Regeneration", "Protection", "Stability", "Alacrity"],
            "revenant": ["Might", "Regeneration", "Protection", "Resistance"],
            "revenant-herald": ["Might", "Regeneration", "Protection", "Resistance", "Vigor", "Swiftness"],
            "revenant-renegade": ["Might", "Alacrity", "Quickness", "Regeneration", "Swiftness"],
            "revenant-vindicator": ["Might", "Fury", "Quickness", "Alacrity", "Regeneration", "Vigor"],
            "revenant-conduit": ["Might", "Alacrity", "Regeneration", "Protection", "Vigor"],
            "warrior": ["Might", "Vigor", "Swiftness"],
            "warrior-berserker": ["Might", "Vigor", "Swiftness", "Fury"],
            "warrior-spellbreaker": ["Might", "Vigor", "Stability", "Protection"],
            "warrior-bladesworn": ["Might", "Fury", "Swiftness", "Vigor", "Quickness"],
            "warrior-paragon": ["Might", "Vigor", "Swiftness", "Stability", "Protection"],
            "ranger": ["Might", "Vigor", "Swiftness", "Regeneration"],
            "ranger-druid": ["Regeneration", "Vigor", "Swiftness", "Might"],
            "ranger-soulbeast": ["Might", "Vigor", "Fury", "Quickness"],
            "ranger-untamed": ["Might", "Vigor", "Swiftness", "Fury", "Resolution"],
            "ranger-galeshot": ["Might", "Vigor", "Swiftness", "Alacrity"],
            "engineer": ["Might", "Swiftness", "Regeneration", "Resistance"],
            "engineer-scrapper": ["Might", "Vigor", "Swiftness", "Regeneration", "Protection"],
            "engineer-holosmith": ["Might", "Fury", "Protection", "Swiftness"],
            "engineer-mechanist": ["Might", "Vigor", "Swiftness", "Regeneration", "Protection", "Stability"],
            "engineer-amalgam": ["Might", "Vigor", "Swiftness", "Protection", "Regeneration"],
            "thief": ["Vigor", "Swiftness", "Fury"],
            "thief-daredevil": ["Vigor", "Swiftness", "Fury", "Might"],
            "thief-deadeye": ["Vigor", "Fury", "Swiftness"],
            "thief-specter": ["Vigor", "Regeneration", "Swiftness", "Resolution"],
            "thief-antiquary": ["Vigor", "Swiftness", "Regeneration"],
            "elementalist": ["Fury", "Might", "Regeneration", "Protection"],
            "elementalist-tempest": ["Fury", "Might", "Vigor", "Swiftness", "Protection", "Stability"],
            "elementalist-weaver": ["Fury", "Might", "Vigor", "Swiftness", "Protection"],
            "elementalist-catalyst": ["Might", "Vigor", "Regeneration", "Stability", "Protection", "Swiftness"],
            "elementalist-evoker": ["Might", "Fury", "Vigor", "Swiftness", "Regeneration"],
            "mesmer": ["Alacrity", "Quickness", "Swiftness", "Regeneration"],
            "mesmer-chronomancer": ["Alacrity", "Quickness", "Regeneration", "Swiftness", "Vigor"],
            "mesmer-mirage": ["Alacrity", "Vigor", "Regeneration", "Protection", "Swiftness"],
            "mesmer-virtuoso": ["Alacrity", "Quickness", "Vigor", "Swiftness"],
            "mesmer-troubadour": ["Alacrity", "Quickness", "Regeneration", "Vigor", "Stability"],
            "necromancer": ["Might", "Regeneration", "Stability"],
            "necromancer-reaper": ["Might", "Regeneration", "Stability", "Vigor"],
            "necromancer-scourge": ["Might", "Regeneration", "Stability", "Protection", "Resolution"],
            "necromancer-harbinger": ["Might", "Regeneration", "Vigor", "Stability", "Alacrity"],
            "necromancer-ritualist": ["Might", "Regeneration", "Stability", "Alacrity", "Resistance"]
        };

        // Boon icons from GW2 Wiki (using static paths)
        const boonIcons = {
            "Might": "https://wiki.guildwars2.com/images/7/7c/Might.png",
            "Fury": "https://wiki.guildwars2.com/images/4/46/Fury.png",
            "Quickness": "https://wiki.guildwars2.com/images/b/b4/Quickness.png",
            "Alacrity": "https://wiki.guildwars2.com/images/4/4c/Alacrity.png",
            "Protection": "https://wiki.guildwars2.com/images/6/6c/Protection.png",
            "Aegis": "https://wiki.guildwars2.com/images/e/e5/Aegis.png",
            "Stability": "https://wiki.guildwars2.com/images/a/ae/Stability.png",
            "Vigor": "https://wiki.guildwars2.com/images/f/f4/Vigor.png",
            "Regeneration": "https://wiki.guildwars2.com/images/5/53/Regeneration.png",
            "Resolution": "https://wiki.guildwars2.com/images/0/06/Resolution.png",
            "Resistance": "https://wiki.guildwars2.com/images/3/3a/Resistance.png",
            "Swiftness": "https://wiki.guildwars2.com/images/a/af/Swiftness.png"
        };

        // Boon colors for visualization
        const boonColors = {
            "Might": "#FF6B6B",      // Red
            "Fury": "#FFD700",       // Gold
            "Quickness": "#00D4FF",  // Cyan
            "Alacrity": "#00FF88",   // Green
            "Protection": "#4169E1", // Royal Blue
            "Aegis": "#9370DB",      // Purple
            "Stability": "#FF8C00",  // Dark Orange
            "Vigor": "#FF1493",      // Deep Pink
            "Regeneration": "#32CD32", // Lime Green
            "Resolution": "#87CEEB", // Sky Blue
            "Resistance": "#FFB6C1", // Light Pink
            "Swiftness": "#FF4500"   // Orange Red
        };

        // Data management
        const rosterData = JSON.parse(localStorage.getItem('gw2Roster')) || [];
        const squadsData = JSON.parse(localStorage.getItem('gw2Squads')) || [];

        // Save squads to localStorage
        function saveSquads() {
            localStorage.setItem('gw2Squads', JSON.stringify(squadsData));
        }

        // Populate boon class select
        function populateBoonSelect() {
            const select = document.getElementById('boonClassSelect');
            const optgroups = {};
            
            for (const [classSpec, boons] of Object.entries(boonsByClass)) {
                const parts = classSpec.split('-');
                const className = parts[0].charAt(0).toUpperCase() + parts[0].slice(1);
                
                if (!optgroups[className]) {
                    optgroups[className] = [];
                }
                optgroups[className].push({ value: classSpec, label: classSpec === parts[0] ? `${className} (Base)` : `${className} - ${parts[1].charAt(0).toUpperCase() + parts[1].slice(1)}` });
            }
            
            select.innerHTML = '<option value="">-- Select Class/Spec to see Boons --</option>';
            for (const [className, specs] of Object.entries(optgroups)) {
                const optgroup = document.createElement('optgroup');
                optgroup.label = className;
                specs.forEach(spec => {
                    const option = document.createElement('option');
                    option.value = spec.value;
                    option.textContent = spec.label;
                    optgroup.appendChild(option);
                });
                select.appendChild(optgroup);
            }
        }

        // Display boons for selected class
        document.getElementById('boonClassSelect').addEventListener('change', function(e) {
            const classSpec = this.value;
            const displayArea = document.getElementById('boonDisplayArea');
            
            if (!classSpec || !boonsByClass[classSpec]) {
                displayArea.innerHTML = '';
                return;
            }
            
            const boons = boonsByClass[classSpec];
            displayArea.innerHTML = boons.map(boon => `
                <div style="background: ${boonColors[boon] || '#666'}; border-radius: 8px; padding: 10px; text-align: center; color: white; font-weight: bold; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3); display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 4px; min-height: 70px;">
                    <img src="${boonIcons[boon] || ''}" alt="${boon}" style="width: 32px; height: 32px; filter: drop-shadow(0 0 2px rgba(0,0,0,0.8));">
                    <span style="font-size: 12px;">${boon}</span>
                </div>
            `).join('');
        });

        // Form submission
        document.getElementById('characterForm').addEventListener('submit', function(e) {
            e.preventDefault();

            const character = {
                id: Date.now(),
                playerName: document.getElementById('playerName').value.trim(),
                characterName: document.getElementById('characterName').value.trim(),
                role: document.getElementById('role').value,
                classSpec: document.getElementById('classSpec').value,
                gear: document.getElementById('gear').value,
                notes: document.getElementById('notes').value.trim(),
                addedDate: new Date().toLocaleDateString()
            };

            rosterData.push(character);
            saveRoster();
            renderRoster();
            updateTeamBoons();
            this.reset();
            
            // Show success message
            alert(`${character.characterName} has been added to the roster!`);
        });

        // Save to localStorage
        function saveRoster() {
            localStorage.setItem('gw2Roster', JSON.stringify(rosterData));
        }

        // Render roster table
        function renderRoster() {
            const tbody = document.getElementById('rosterBody');
            
            if (rosterData.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" class="text-center py-8 text-gray-500">No characters registered yet. Add your first character above!</td></tr>';
                updateStats();
                return;
            }

            tbody.innerHTML = rosterData.map(char => `
                <tr>
                    <td><strong>${escapeHtml(char.playerName)}</strong></td>
                    <td>${escapeHtml(char.characterName)}</td>
                    <td><span class="badge">${capitalize(char.role)}</span></td>
                    <td>${escapeHtml(char.classSpec)}</td>
                    <td><span class="badge">${char.gear}</span></td>
                    <td>${escapeHtml(char.notes || '-')}</td>
                    <td>
                        <button onclick="deleteCharacter(${char.id})" class="text-red-400 hover:text-red-300 text-sm font-semibold">Delete</button>
                    </td>
                </tr>
            `).join('');

            updateStats();
        }

        // Delete character
        function deleteCharacter(id) {
            if (confirm('Are you sure you want to delete this character?')) {
                const index = rosterData.findIndex(c => c.id === id);
                if (index > -1) {
                    rosterData.splice(index, 1);
                    saveRoster();
                    renderRoster();
                    updateTeamBoons();
                }
            }
        }

        // Update statistics
        function updateStats() {
            const uniquePlayers = new Set(rosterData.map(c => c.playerName)).size;
            document.getElementById('totalPlayers').textContent = uniquePlayers;
            document.getElementById('totalCharacters').textContent = rosterData.length;

            if (rosterData.length > 0) {
                const roles = rosterData.map(c => c.role);
                const commonRole = roles.reduce((a, b) => roles.filter(x => x === a).length > roles.filter(x => x === b).length ? a : b);
                document.getElementById('commonRole').textContent = capitalize(commonRole);

                const specs = rosterData.map(c => c.classSpec);
                const commonSpec = specs.reduce((a, b) => specs.filter(x => x === a).length > specs.filter(x => x === b).length ? a : b);
                document.getElementById('commonClass').textContent = commonSpec;
            }
        }

        // Update Team Boons Analysis
        function updateTeamBoons() {
            const teamBoonDisplay = document.getElementById('teamBoonDisplay');
            const boonCoverageDisplay = document.getElementById('boonCoverageDisplay');
            const emptyMessage = document.getElementById('emptyRosterMessage');

            if (rosterData.length === 0) {
                teamBoonDisplay.innerHTML = '';
                boonCoverageDisplay.innerHTML = '';
                emptyMessage.style.display = 'block';
                return;
            }

            emptyMessage.style.display = 'none';

            // Collect all boons from roster characters
            const allBoons = {};
            const boonProvidedBy = {};

            rosterData.forEach(character => {
                const classSpec = character.classSpec;
                if (boonsByClass[classSpec]) {
                    boonsByClass[classSpec].forEach(boon => {
                        if (!allBoons[boon]) {
                            allBoons[boon] = 0;
                            boonProvidedBy[boon] = [];
                        }
                        allBoons[boon]++;
                        boonProvidedBy[boon].push(character.characterName);
                    });
                }
            });

            // Sort boons by frequency
            const sortedBoons = Object.entries(allBoons).sort((a, b) => b[1] - a[1]);

            // Display team boons
            if (sortedBoons.length === 0) {
                teamBoonDisplay.innerHTML = '<div class="col-span-full text-center text-gray-500">No boons in roster</div>';
            } else {
                teamBoonDisplay.innerHTML = sortedBoons.map(([boon, count]) => `
                    <div style="background: ${boonColors[boon] || '#666'}; border-radius: 8px; padding: 10px; text-align: center; color: white; font-weight: bold; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3); position: relative; cursor: help; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 4px;" title="${boonProvidedBy[boon].join(', ')}">
                        <img src="${boonIcons[boon] || ''}" alt="${boon}" style="width: 28px; height: 28px; filter: drop-shadow(0 0 2px rgba(0,0,0,0.8));">
                        <div style="font-size: 10px; opacity: 0.9;">√ó${count}</div>
                    </div>
                `).join('');
            }

            // Display boon coverage summary
            const criticalBoons = ["Quickness", "Alacrity", "Might", "Protection"];
            const coverageHtml = criticalBoons.map(boon => {
                const provided = allBoons[boon] || 0;
                const providers = boonProvidedBy[boon] || [];
                const status = provided > 0 ? '‚úì' : '‚úó';
                const statusColor = provided > 0 ? '#00FF88' : '#FF6B6B';
                return `
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 8px; background: rgba(0,0,0,0.3); border-radius: 6px; border-left: 3px solid ${statusColor}; gap: 8px;">
                        <div style="display: flex; align-items: center; gap: 6px;">
                            <img src="${boonIcons[boon] || ''}" alt="${boon}" style="width: 20px; height: 20px;">
                            <div>
                                <strong>${boon}</strong>
                                <div style="font-size: 12px; color: #999;">Provided by ${provided > 0 ? providers.length : 0} member(s)</div>
                            </div>
                        </div>
                        <span style="font-size: 18px; color: ${statusColor}; font-weight: bold;">${status}</span>
                    </div>
                `;
            }).join('');

            boonCoverageDisplay.innerHTML = coverageHtml;
        }

        // Export roster
        document.getElementById('exportBtn').addEventListener('click', function() {
            const dataStr = JSON.stringify(rosterData, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `team-roster-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            URL.revokeObjectURL(url);
        });

        // Import roster
        document.getElementById('importBtn').addEventListener('click', function() {
            document.getElementById('importFile').click();
        });

        document.getElementById('importFile').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(event) {
                try {
                    const imported = JSON.parse(event.target.result);
                    if (Array.isArray(imported)) {
                        if (confirm(`Import ${imported.length} character(s)? This will add to existing roster.`)) {
                            rosterData.push(...imported);
                            saveRoster();
                            renderRoster();
                            alert('Roster imported successfully!');
                        }
                    } else {
                        alert('Invalid roster file format.');
                    }
                } catch (err) {
                    alert('Error reading file: ' + err.message);
                }
            };
            reader.readAsText(file);
        });

        // Import Squad from JSON
        document.getElementById('importSquadBtn').addEventListener('click', function() {
            document.getElementById('importSquadFile').click();
        });

        document.getElementById('importSquadFile').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(event) {
                try {
                    const imported = JSON.parse(event.target.result);
                    if (Array.isArray(imported) && imported.length > 0) {
                        const squadName = prompt('Enter a name for this squad:', `Squad ${squadsData.length + 1}`);
                        if (squadName) {
                            squadsData.push({
                                id: Date.now(),
                                name: squadName,
                                members: imported,
                                importedDate: new Date().toISOString()
                            });
                            saveSquads();
                            alert(`Squad "${squadName}" imported successfully with ${imported.length} members!`);
                        }
                    } else {
                        alert('Invalid squad file format.');
                    }
                } catch (err) {
                    alert('Error reading file: ' + err.message);
                }
            };
            reader.readAsText(file);
            this.value = ''; // Reset input
        });

        // Manage Squads Modal
        document.getElementById('manageSquadsBtn').addEventListener('click', function() {
            renderSquadsList();
            document.getElementById('squadsModal').style.display = 'block';
        });

        document.getElementById('closeSquadsModal').addEventListener('click', function() {
            document.getElementById('squadsModal').style.display = 'none';
        });

        // Render Squads List
        function renderSquadsList() {
            const container = document.getElementById('squadsListContainer');
            
            if (squadsData.length === 0) {
                container.innerHTML = '<div class="text-center py-8 text-gray-500">No squads imported yet. Import a JSON roster as a squad to get started.</div>';
                return;
            }

            container.innerHTML = squadsData.map(squad => {
                const allBoons = {};
                squad.members.forEach(member => {
                    const classSpec = member.classSpec;
                    if (boonsByClass[classSpec]) {
                        boonsByClass[classSpec].forEach(boon => {
                            allBoons[boon] = (allBoons[boon] || 0) + 1;
                        });
                    }
                });

                const sortedBoons = Object.entries(allBoons).sort((a, b) => b[1] - a[1]).slice(0, 6);

                return `
                    <div style="background: rgba(35, 35, 35, 0.8); border-left: 4px solid #00d4ff; padding: 16px; margin-bottom: 16px; border-radius: 8px;">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 12px;">
                            <div>
                                <h3 style="font-size: 18px; font-weight: bold; color: #00d4ff; margin-bottom: 4px;">${escapeHtml(squad.name)}</h3>
                                <p style="font-size: 12px; color: #999;">Imported: ${new Date(squad.importedDate).toLocaleDateString()} ‚Ä¢ ${squad.members.length} members</p>
                            </div>
                            <div style="display: flex; gap: 8px;">
                                <button onclick="viewSquad(${squad.id})" class="btn-secondary" style="padding: 6px 12px; font-size: 12px;">View</button>
                                <button onclick="exportSquad(${squad.id})" class="btn-secondary" style="padding: 6px 12px; font-size: 12px;">Export</button>
                                <button onclick="mergeSquadToRoster(${squad.id})" class="btn-primary" style="padding: 6px 12px; font-size: 12px;">Merge to Roster</button>
                                <button onclick="deleteSquad(${squad.id})" class="text-red-400 hover:text-red-300" style="padding: 6px 12px; font-size: 12px; font-weight: bold;">Delete</button>
                            </div>
                        </div>
                        <div style="display: flex; gap: 4px; flex-wrap: wrap;">
                            ${sortedBoons.map(([boon, count]) => `
                                <div style="display: flex; align-items: center; gap: 4px; background: rgba(0,0,0,0.5); padding: 4px 8px; border-radius: 4px;">
                                    <img src="${boonIcons[boon] || ''}" alt="${boon}" style="width: 16px; height: 16px;">
                                    <span style="font-size: 11px;">√ó${count}</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            }).join('');
        }

        // View Squad Details
        function viewSquad(squadId) {
            const squad = squadsData.find(s => s.id === squadId);
            if (!squad) return;

            const details = squad.members.map(m => 
                `‚Ä¢ ${m.characterName} (${m.playerName}) - ${m.classSpec} - ${m.role}`
            ).join('\n');

            alert(`Squad: ${squad.name}\n\nMembers (${squad.members.length}):\n${details}`);
        }

        // Export Squad as JSON
        function exportSquad(squadId) {
            const squad = squadsData.find(s => s.id === squadId);
            if (!squad) return;

            const dataStr = JSON.stringify(squad.members, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            const fileName = squad.name.replace(/[^a-z0-9]/gi, '_').toLowerCase();
            link.href = url;
            link.download = `${fileName}_squad_${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            URL.revokeObjectURL(url);
        }

        // Merge Squad to Roster
        function mergeSquadToRoster(squadId) {
            const squad = squadsData.find(s => s.id === squadId);
            if (!squad) return;

            if (confirm(`Merge "${squad.name}" (${squad.members.length} members) into your roster?`)) {
                rosterData.push(...squad.members);
                saveRoster();
                renderRoster();
                updateTeamBoons();
                alert(`${squad.members.length} members merged successfully!`);
                document.getElementById('squadsModal').style.display = 'none';
            }
        }

        // Delete Squad
        function deleteSquad(squadId) {
            const squad = squadsData.find(s => s.id === squadId);
            if (!squad) return;

            if (confirm(`Delete squad "${squad.name}"?`)) {
                const index = squadsData.findIndex(s => s.id === squadId);
                if (index > -1) {
                    squadsData.splice(index, 1);
                    saveSquads();
                    renderSquadsList();
                }
            }
        }

        // Utility functions
        function capitalize(str) {
            return str.charAt(0).toUpperCase() + str.slice(1);
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Initial render
        populateBoonSelect();
        renderRoster();
        updateTeamBoons();
    </script>
</body>
</html>
